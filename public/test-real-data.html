<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>TEST - Vos vraies donnÃ©es FAITHCHRONICLES</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }
        .user-card { background: #f9f9f9; margin: 10px 0; padding: 15px; border-radius: 5px; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        button { background: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” TEST - Vos vraies donnÃ©es FAITHCHRONICLES</h1>
        
        <button onclick="testRealData()">ğŸ® Tester donnÃ©es rÃ©elles</button>
        <button onclick="testUsersTable()">ğŸ‘¥ Tester table users</button>
        
        <div id="results"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const SUPABASE_URL = 'https://dmszyxowetilvsanqsxm.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRtc3p5eG93ZXRpbHZzYW5xc3htIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mjk2OTQ0MTUsImV4cCI6MjA0NTI3MDQxNX0.gdKBKHZiYGmNfFV6vGdJ4J6EiZwjrLdA_lSaXPJqBGk';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        function addResult(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `user-card ${type}`;
            div.innerHTML = message;
            results.appendChild(div);
        }
        
        async function testRealData() {
            addResult('ğŸ” Test des donnÃ©es rÃ©elles FAITHCHRONICLES...', 'info');
            
            try {
                // Test 1: faithchronicles_profiles seul
                const { data: profiles, error: profilesError } = await supabase
                    .from('faithchronicles_profiles')
                    .select('*');
                
                if (profilesError) throw profilesError;
                
                addResult(`âœ… faithchronicles_profiles: ${profiles?.length || 0} profils trouvÃ©s`, 'success');
                profiles?.forEach(profile => {
                    addResult(`   ğŸ‘¤ ${profile.username} (${profile.id})`, 'info');
                });
                
                // Test 2: game_progress seul
                const { data: progress, error: progressError } = await supabase
                    .from('faithchronicles_game_progress')
                    .select('*')
                    .order('wisdom_points', { ascending: false });
                
                if (progressError) throw progressError;
                
                addResult(`âœ… faithchronicles_game_progress: ${progress?.length || 0} progressions trouvÃ©es`, 'success');
                progress?.forEach(prog => {
                    addResult(`   ğŸ® UserID: ${prog.user_id.slice(0, 8)}... - ${prog.wisdom_points} points de sagesse`, 'info');
                });
                
                // Test 3: JOIN des deux
                const { data: joined, error: joinError } = await supabase
                    .from('faithchronicles_game_progress')
                    .select(`
                        wisdom_points,
                        current_level,
                        user_id,
                        faithchronicles_profiles!inner (username)
                    `)
                    .order('wisdom_points', { ascending: false });
                
                if (joinError) {
                    addResult(`âš ï¸ JOIN impossible: ${joinError.message}`, 'error');
                } else {
                    addResult(`âœ… JOIN rÃ©ussi: ${joined?.length || 0} entrÃ©es jointes`, 'success');
                    joined?.forEach((entry, index) => {
                        addResult(`   ğŸ† ${index + 1}. ${entry.faithchronicles_profiles.username} - ${entry.wisdom_points} points`, 'success');
                    });
                }
                
            } catch (error) {
                addResult(`âŒ Erreur: ${error.message}`, 'error');
            }
        }
        
        async function testUsersTable() {
            addResult('ğŸ” Test de la table users globale...', 'info');
            
            try {
                const { data: users, error: usersError } = await supabase
                    .from('users')
                    .select('*');
                
                if (usersError) throw usersError;
                
                addResult(`âœ… Table users: ${users?.length || 0} utilisateurs trouvÃ©s`, 'success');
                users?.forEach(user => {
                    addResult(`   âœ¨ ${user.pseudo} (${user.email}) - ${user.avatar}`, 'info');
                });
                
                if (users && users.length > 0) {
                    addResult('ğŸ’¡ Votre pseudo est bien dans la table users globale !', 'success');
                } else {
                    addResult('âš ï¸ Table users vide - le problÃ¨me est lÃ  !', 'error');
                }
                
            } catch (error) {
                addResult(`âŒ Erreur table users: ${error.message}`, 'error');
            }
        }
        
        // Auto-test au chargement
        window.onload = () => {
            addResult('ğŸš€ Page de diagnostic chargÃ©e. Cliquez sur les boutons pour tester !', 'info');
        };
    </script>
</body>
</html>